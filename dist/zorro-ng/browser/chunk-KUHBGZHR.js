import{a as V,b as N,e as B,h as L,i as G,k as z,m as A}from"./chunk-OGDTTBTQ.js";import{a as W,b as U}from"./chunk-6QFG5ZSD.js";import{Ba as a,Ca as y,Oa as _,Qa as d,Qb as D,Ra as E,Sb as F,Ta as t,Tb as I,Ua as n,Ya as S,Za as h,_a as O,aa as x,db as i,eb as g,gb as k,ib as u,ja as R,jb as b,ka as w,kb as f,mb as P,nb as v,ob as T}from"./chunk-TYC4EHML.js";function q(s,p){if(s&1&&(t(0,"option",26),i(1),n()),s&2){let l=p.$implicit;d("ngValue",l.id),a(),g(l.nombre)}}function H(s,p){if(s&1&&(t(0,"option",26),i(1),n()),s&2){let l=p.$implicit;d("ngValue",l.nombre),a(),g(l.nombre)}}function $(s,p){if(s&1&&(t(0,"option",26),i(1),n()),s&2){let l=p.$implicit;d("ngValue",l.nombre),a(),k("",l.nombre," ",l.apellido," ")}}function J(s,p){if(s&1){let l=S();t(0,"tr")(1,"td"),i(2),n(),t(3,"td"),i(4),v(5,"date"),n(),t(6,"td"),i(7),n(),t(8,"td"),i(9),n(),t(10,"td")(11,"button",27),h("click",function(){let c=R(l).$implicit,e=O();return w(e.openDeleteModal(c.id))}),i(12,"Eliminar"),n()()()}if(s&2){let l=p.$implicit;a(2),g(l.id),a(2),g(T(5,4,l.fechaGeneracion,"short")),a(3),g(l.periodo),a(2),g(l.tipoReporteNombre)}}var ne=(()=>{let p=class p{constructor(o){this.http=o,this.tiposReporte=[],this.reportes=[],this.materias=[],this.docentes=[],this.selectedTipoReporte=null,this.selectedMateria=null,this.selectedDocente=null,this.fechaInicio=null,this.fechaFin=null,this.reportUrl="http://68.183.146.53/reportes/",this.tipoReporteUrl="http://68.183.146.53/tiporeportes/",this.materiasUrl="http://68.183.146.53/materias/",this.docentesUrl="http://68.183.146.53/docentes/",this.generatingReport=!1,this.showDeleteModal=!1,this.reportIdToDelete=null}ngOnInit(){this.loadTiposReporte(),this.loadReportes(),this.loadMaterias(),this.loadDocentes()}loadTiposReporte(){this.http.get(this.tipoReporteUrl).subscribe(o=>{this.tiposReporte=o,this.mapReportesTipoNombre()},o=>{console.error("Error loading tipos de reporte",o)})}loadReportes(){this.http.get(this.reportUrl).subscribe(o=>{this.reportes=o,this.mapReportesTipoNombre()},o=>{console.error("Error loading reportes",o)})}loadMaterias(){this.http.get(this.materiasUrl).subscribe(o=>{this.materias=o},o=>{console.error("Error loading materias",o)})}loadDocentes(){this.http.get(this.docentesUrl).subscribe(o=>{this.docentes=o},o=>{console.error("Error loading docentes",o)})}mapReportesTipoNombre(){this.tiposReporte.length>0&&this.reportes.length>0&&this.reportes.forEach(o=>{let c=this.tiposReporte.find(e=>e.id===o.tipoReporteId);c&&(o.tipoReporteNombre=c.nombre)})}generateReport(o){if(this.selectedTipoReporte!==null){this.generatingReport=!0;let c;switch(this.selectedTipoReporte){case 1:c="asistencias";break;case 2:c="atrasos";break;case 3:c="faltas";break;case 4:c="licencias";break;default:c="asistencias"}let e=new W;this.fechaInicio&&(e=e.set("fechaInicio",this.fechaInicio)),this.fechaFin&&(e=e.set("fechaFin",this.fechaFin)),this.selectedMateria&&(e=e.set("materia",this.selectedMateria)),this.selectedDocente&&(e=e.set("docente",this.selectedDocente));let m=`${this.reportUrl}${c}/${o}`;this.http.get(m,{responseType:"blob",params:e}).subscribe(r=>{let j=new Blob([r],{type:o==="pdf"?"application/pdf":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),C=window.URL.createObjectURL(j),M=document.createElement("a");M.href=C,M.download=o==="pdf"?`reporte_${this.selectedTipoReporte}.pdf`:`reporte_${this.selectedTipoReporte}.xlsx`,M.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window})),this.generatingReport=!1,setTimeout(()=>{window.URL.revokeObjectURL(C),location.reload()},1e3)},r=>{console.error("Error generating report",r),this.generatingReport=!1})}else alert("Seleccione un tipo de reporte")}openDeleteModal(o){this.reportIdToDelete=o,this.showDeleteModal=!0}closeDeleteModal(){this.showDeleteModal=!1,this.reportIdToDelete=null}confirmDelete(){this.reportIdToDelete!==null&&this.http.delete(`${this.reportUrl}${this.reportIdToDelete}`).subscribe(()=>{this.loadReportes(),this.closeDeleteModal()},o=>{console.error("Error deleting reporte",o),this.closeDeleteModal()})}};p.\u0275fac=function(c){return new(c||p)(y(U))},p.\u0275cmp=x({type:p,selectors:[["app-reporte"]],standalone:!0,features:[P],decls:64,vars:16,consts:[[1,"container","mt-5"],[1,"text-center"],[1,"form-group"],["for","tipoReporte"],["id","tipoReporte",1,"form-control",3,"ngModelChange","ngModel"],["disabled","","selected","",3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"form-group","mt-3"],["for","fechaInicio"],["type","date","id","fechaInicio",1,"form-control",3,"ngModelChange","ngModel"],["for","fechaFin"],["type","date","id","fechaFin",1,"form-control",3,"ngModelChange","ngModel"],["for","materia"],["id","materia",1,"form-control",3,"ngModelChange","ngModel"],["for","docente"],["id","docente",1,"form-control",3,"ngModelChange","ngModel"],[1,"mt-3"],[1,"btn","btn-primary","btn-block",3,"click","disabled"],[1,"btn","btn-success","btn-block",3,"click","disabled"],[1,"mt-5","text-center"],[1,"table","table-bordered","mt-3"],[4,"ngFor","ngForOf"],[1,"modal"],[1,"modal-content"],[1,"btn","btn-primary",3,"click"],[1,"btn","btn-secondary",3,"click"],[3,"ngValue"],[1,"btn","btn-sm","btn-danger",3,"click"]],template:function(c,e){c&1&&(t(0,"div",0)(1,"h2",1),i(2,"Generar Reporte"),n(),t(3,"div",2)(4,"label",3),i(5,"Tipo de Reporte"),n(),t(6,"select",4),f("ngModelChange",function(r){return b(e.selectedTipoReporte,r)||(e.selectedTipoReporte=r),r}),t(7,"option",5),i(8,"Seleccione un tipo de reporte"),n(),_(9,q,2,2,"option",6),n()(),t(10,"div",7)(11,"label",8),i(12,"Fecha Inicio"),n(),t(13,"input",9),f("ngModelChange",function(r){return b(e.fechaInicio,r)||(e.fechaInicio=r),r}),n()(),t(14,"div",7)(15,"label",10),i(16,"Fecha Fin"),n(),t(17,"input",11),f("ngModelChange",function(r){return b(e.fechaFin,r)||(e.fechaFin=r),r}),n()(),t(18,"div",7)(19,"label",12),i(20,"Materia"),n(),t(21,"select",13),f("ngModelChange",function(r){return b(e.selectedMateria,r)||(e.selectedMateria=r),r}),t(22,"option",5),i(23,"Seleccione una materia"),n(),_(24,H,2,2,"option",6),n()(),t(25,"div",7)(26,"label",14),i(27,"Docente"),n(),t(28,"select",15),f("ngModelChange",function(r){return b(e.selectedDocente,r)||(e.selectedDocente=r),r}),t(29,"option",5),i(30,"Seleccione un docente"),n(),_(31,$,2,3,"option",6),n()(),t(32,"div",16)(33,"button",17),h("click",function(){return e.generateReport("pdf")}),i(34,"Generar PDF"),n(),t(35,"button",18),h("click",function(){return e.generateReport("excel")}),i(36,"Generar Excel"),n()(),t(37,"h2",19),i(38,"Reportes Generados"),n(),t(39,"table",20)(40,"thead")(41,"tr")(42,"th"),i(43,"ID"),n(),t(44,"th"),i(45,"Fecha Generaci\xF3n"),n(),t(46,"th"),i(47,"Periodo"),n(),t(48,"th"),i(49,"Tipo"),n(),t(50,"th"),i(51,"Acciones"),n()()(),t(52,"tbody"),_(53,J,13,7,"tr",21),n()()(),t(54,"div",22)(55,"div",23)(56,"h3"),i(57,"Confirmar Eliminaci\xF3n"),n(),t(58,"p"),i(59,"\xBFEst\xE1s seguro de que quieres eliminar este reporte?"),n(),t(60,"button",24),h("click",function(){return e.confirmDelete()}),i(61,"Aceptar"),n(),t(62,"button",25),h("click",function(){return e.closeDeleteModal()}),i(63,"Cancelar"),n()()()),c&2&&(a(6),u("ngModel",e.selectedTipoReporte),a(),d("ngValue",null),a(2),d("ngForOf",e.tiposReporte),a(4),u("ngModel",e.fechaInicio),a(4),u("ngModel",e.fechaFin),a(4),u("ngModel",e.selectedMateria),a(),d("ngValue",null),a(2),d("ngForOf",e.materias),a(4),u("ngModel",e.selectedDocente),a(),d("ngValue",null),a(2),d("ngForOf",e.docentes),a(2),d("disabled",e.generatingReport),a(2),d("disabled",e.generatingReport),a(18),d("ngForOf",e.reportes),a(),E("show",e.showDeleteModal))},dependencies:[I,D,F,A,G,z,V,L,N,B],styles:[".container[_ngcontent-%COMP%]{max-width:800px;margin:0 auto;padding:20px;background-color:#f8f9fa;border-radius:8px;box-shadow:0 0 10px #0000001a}h2[_ngcontent-%COMP%]{text-align:center;margin-bottom:20px;font-size:1.75rem;color:#343a40}.form-group[_ngcontent-%COMP%]{margin-bottom:20px}label[_ngcontent-%COMP%]{font-weight:700;color:#495057}select.form-control[_ngcontent-%COMP%]{width:100%;padding:10px;font-size:1rem;border:1px solid #ced4da;border-radius:4px}button[_ngcontent-%COMP%]{padding:10px;font-size:1rem;border:none;border-radius:4px;cursor:pointer;transition:background-color .3s ease}button.btn-block[_ngcontent-%COMP%]{width:100%}button.btn-primary[_ngcontent-%COMP%]{background-color:#007bff;color:#fff}button.btn-primary[_ngcontent-%COMP%]:hover{background-color:#0056b3}button.btn-success[_ngcontent-%COMP%]{background-color:#28a745;color:#fff}button.btn-success[_ngcontent-%COMP%]:hover{background-color:#218838}button.btn-warning[_ngcontent-%COMP%]{background-color:#ffc107;color:#fff}button.btn-warning[_ngcontent-%COMP%]:hover{background-color:#e0a800}button.btn-danger[_ngcontent-%COMP%]{background-color:#dc3545;color:#fff}button.btn-danger[_ngcontent-%COMP%]:hover{background-color:#c82333}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:10px;text-align:left;border:1px solid #dee2e6}th[_ngcontent-%COMP%]{background-color:#343a40;color:#fff}a.btn-sm[_ngcontent-%COMP%], button.btn-sm[_ngcontent-%COMP%]{margin-right:5px}.btn-yellow[_ngcontent-%COMP%]{background-color:#ffc107;border:1px solid #ffc107;color:#000;font-weight:700;padding:.5rem 1rem;border-radius:.25rem;text-transform:uppercase;box-shadow:0 2px 4px #0003;transition:background-color .3s ease,box-shadow .3s ease;cursor:pointer;display:inline-block;text-align:center;margin-right:.5rem}.btn-yellow[_ngcontent-%COMP%]:hover{background-color:#e0a800;border-color:#d39e00;box-shadow:0 4px 8px #0000004d;color:#0a0238;text-decoration:none}.btn-danger[_ngcontent-%COMP%]{background-color:red;color:#fff}.modal[_ngcontent-%COMP%]{display:none;position:fixed;z-index:1;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:#0b023766}.modal.show[_ngcontent-%COMP%]{display:block}.modal-content[_ngcontent-%COMP%]{background-color:#fefefe;margin:15% auto;padding:20px;border:1px solid #888;width:80%;max-width:500px;border-radius:8px;box-shadow:0 0 10px #0003}.modal-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-top:0}.modal-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:20px 0}.modal-content[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-right:10px}"]});let s=p;return s})();export{ne as ReporteComponent};
