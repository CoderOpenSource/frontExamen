import{a as J}from"./chunk-4IA42FLE.js";import{a as $,b as W,c as j,d as B,e as U,f as G,h as H,i as q,k as z,m as V}from"./chunk-OGDTTBTQ.js";import{b as k}from"./chunk-6QFG5ZSD.js";import{Ba as s,Ca as E,Oa as g,Pb as P,Qa as m,Qb as F,Rb as T,Sa as N,Ta as o,Tb as D,Ua as n,Va as O,Ya as x,Za as h,_a as p,aa as S,db as l,eb as b,fb as L,gb as v,ib as C,ja as f,jb as M,ka as _,kb as w,mb as I,sa as y,ya as A}from"./chunk-TYC4EHML.js";function Y(c,r){if(c&1&&(o(0,"option",20),l(1),n()),c&2){let a=r.$implicit;m("value",a.id),s(),v("",a.nombre," ",a.apellido,"")}}function Z(c,r){if(c&1&&(o(0,"option",20),l(1),n()),c&2){let a=r.$implicit,e=p();m("value",a.id),s(),b(e.getProgramacionDescripcion(a))}}function ee(c,r){if(c&1&&(o(0,"div",21),l(1),n()),c&2){let a=p();m("ngClass",a.toastClass),s(),L(" ",a.toastMessage," ")}}var K=(()=>{let r=class r{constructor(e){this.http=e,this.licencia={id:null,docenteId:null,programacionAcademicaId:null,fecha:"",motivo:"",fotoLicencia:null},this.isEditMode=!1,this.docentes=[],this.programaciones=[],this.closeModal=new y,this.saveLicencia=new y,this.fileSelected=new y,this.materias=[],this.aulas=[],this.sesionesClase=[],this.toastMessage=null,this.toastClass=""}ngOnInit(){this.loadMaterias(),this.loadAulas(),this.loadSesionesClase()}loadMaterias(){this.http.get("http://192.168.0.18/materias/").subscribe(e=>{this.materias=e},e=>{console.error("Error loading materias",e)})}loadAulas(){this.http.get("http://192.168.0.18/aulas/").subscribe(e=>{this.aulas=e},e=>{console.error("Error loading aulas",e)})}loadSesionesClase(){this.http.get("http://192.168.0.18/sesionesclase/").subscribe(e=>{this.sesionesClase=e},e=>{console.error("Error loading sesiones clase",e)})}getProgramacionDescripcion(e){let i=this.materias.find(d=>d.id===e.materiaId),t=this.aulas.find(d=>d.id===e.aulaId),u=this.getFormattedSesionClase(e.sesionClaseIds);return`${e.grupo}: ${i?.nombre||"Desconocido"} - ${t?.nombre||"Desconocido"} (${u})`}getFormattedSesionClase(e){return this.sesionesClase.filter(t=>e.includes(t.id)).map(t=>`${t.diaSemana.slice(0,3).toUpperCase()} ${t.horaInicio}-${t.horaFin}`).join(", ")}showToast(e,i){this.toastMessage=e,this.toastClass=i==="success"?"bg-green-500 text-white":"bg-red-500 text-white",setTimeout(()=>{this.toastMessage=null},2e3)}onClose(){this.closeModal.emit()}onSave(){this.saveLicencia.emit(this.licencia)}onFileSelected(e){this.fileSelected.emit(e)}};r.\u0275fac=function(i){return new(i||r)(E(k))},r.\u0275cmp=S({type:r,selectors:[["app-licencia-modal"]],inputs:{licencia:"licencia",isEditMode:"isEditMode",docentes:"docentes",programaciones:"programaciones"},outputs:{closeModal:"closeModal",saveLicencia:"saveLicencia",fileSelected:"fileSelected"},standalone:!0,features:[I],decls:32,vars:10,consts:[[1,"fixed","inset-0","flex","items-center","justify-center","bg-black","bg-opacity-50"],[1,"bg-white","p-4","rounded-lg","shadow-md","w-1/2"],[1,"text-xl","font-bold","mb-4"],[3,"ngSubmit"],["for","docente",1,"block","text-sm","font-medium","text-gray-700"],["id","docente","name","docenteId",1,"mt-1","block","w-full","py-2","px-3","border","border-gray-300","bg-white","rounded-md","shadow-sm","focus:outline-none","focus:ring-indigo-500","focus:border-indigo-500","sm:text-sm",3,"ngModelChange","ngModel"],["disabled","",3,"ngValue"],[3,"value",4,"ngFor","ngForOf"],["for","programacion",1,"block","text-sm","font-medium","text-gray-700"],["id","programacion","name","programacionAcademicaId",1,"mt-1","block","w-full","py-2","px-3","border","border-gray-300","bg-white","rounded-md","shadow-sm","focus:outline-none","focus:ring-indigo-500","focus:border-indigo-500","sm:text-sm",3,"ngModelChange","ngModel"],["for","fecha",1,"block","text-sm","font-medium","text-gray-700"],["type","date","id","fecha","name","fecha",1,"mt-1","block","w-full","py-2","px-3","border","border-gray-300","bg-white","rounded-md","shadow-sm","focus:outline-none","focus:ring-indigo-500","focus:border-indigo-500","sm:text-sm",3,"ngModelChange","ngModel"],["for","motivo",1,"block","text-sm","font-medium","text-gray-700"],["type","text","id","motivo","name","motivo",1,"mt-1","block","w-full","py-2","px-3","border","border-gray-300","bg-white","rounded-md","shadow-sm","focus:outline-none","focus:ring-indigo-500","focus:border-indigo-500","sm:text-sm",3,"ngModelChange","ngModel"],["for","file",1,"block","text-sm","font-medium","text-gray-700"],["type","file","id","file",1,"mt-1","block","w-full","py-2","px-3","border","border-gray-300","bg-white","rounded-md","shadow-sm","focus:outline-none","focus:ring-indigo-500","focus:border-indigo-500","sm:text-sm",3,"change"],[1,"mt-4","flex","justify-end"],["type","button",1,"bg-gray-500","text-white","px-4","py-2","rounded-md","mr-2",3,"click"],["type","submit",1,"bg-blue-500","text-white","px-4","py-2","rounded-md"],["class","mt-4",3,"ngClass",4,"ngIf"],[3,"value"],[1,"mt-4",3,"ngClass"]],template:function(i,t){i&1&&(o(0,"div",0)(1,"div",1)(2,"h2",2),l(3),n(),o(4,"form",3),h("ngSubmit",function(){return t.onSave()}),o(5,"label",4),l(6,"Docente:"),n(),o(7,"select",5),w("ngModelChange",function(d){return M(t.licencia.docenteId,d)||(t.licencia.docenteId=d),d}),o(8,"option",6),l(9,"Seleccione el docente"),n(),g(10,Y,2,3,"option",7),n(),o(11,"label",8),l(12,"Programaci\xF3n Acad\xE9mica:"),n(),o(13,"select",9),w("ngModelChange",function(d){return M(t.licencia.programacionAcademicaId,d)||(t.licencia.programacionAcademicaId=d),d}),o(14,"option",6),l(15,"Seleccione la programaci\xF3n acad\xE9mica"),n(),g(16,Z,2,2,"option",7),n(),o(17,"label",10),l(18,"Fecha:"),n(),o(19,"input",11),w("ngModelChange",function(d){return M(t.licencia.fecha,d)||(t.licencia.fecha=d),d}),n(),o(20,"label",12),l(21,"Motivo:"),n(),o(22,"input",13),w("ngModelChange",function(d){return M(t.licencia.motivo,d)||(t.licencia.motivo=d),d}),n(),o(23,"label",14),l(24,"Foto Licencia:"),n(),o(25,"input",15),h("change",function(d){return t.onFileSelected(d)}),n(),o(26,"div",16)(27,"button",17),h("click",function(){return t.onClose()}),l(28,"Cancelar"),n(),o(29,"button",18),l(30,"Guardar"),n()()(),g(31,ee,2,2,"div",19),n()()),i&2&&(s(3),b(t.isEditMode?"Editar Licencia":"A\xF1adir Licencia"),s(4),C("ngModel",t.licencia.docenteId),s(),m("ngValue",null),s(2),m("ngForOf",t.docentes),s(3),C("ngModel",t.licencia.programacionAcademicaId),s(),m("ngValue",null),s(2),m("ngForOf",t.programaciones),s(3),C("ngModel",t.licencia.fecha),s(3),C("ngModel",t.licencia.motivo),s(9),m("ngIf",t.toastMessage))},dependencies:[D,P,F,T,V,G,q,z,$,H,W,j,U,B]});let c=r;return c})();function te(c,r){if(c&1&&O(0,"img",12),c&2){let a=p().$implicit;m("src",a.fotoLicencia,A)}}function ie(c,r){if(c&1){let a=x();o(0,"button",13),h("click",function(){f(a);let i=p().$implicit,t=p();return _(t.editLicencia(i.id))}),l(1,"Editar"),n()}}function ne(c,r){if(c&1){let a=x();o(0,"button",14),h("click",function(){f(a);let i=p().$implicit,t=p();return _(t.confirmDelete(i.id))}),l(1,"Eliminar"),n()}}function oe(c,r){if(c&1&&(o(0,"tr")(1,"td",3),l(2),n(),o(3,"td",3),l(4),n(),o(5,"td",3),l(6),n(),o(7,"td",3),l(8),n(),o(9,"td",3),l(10),n(),o(11,"td",3),g(12,te,1,1,"img",9),n(),o(13,"td",3),g(14,ie,2,0,"button",10)(15,ne,2,0,"button",11),n()()),c&2){let a=r.$implicit,e=p();s(2),b(a.id),s(2),v("",e.getNombreDocente(a.docenteId)," ",e.getApellido(a.docenteId),""),s(2),b(e.getProgramacionDescripcion(a.programacionAcademicaId)),s(2),b(a.fecha),s(2),b(a.motivo),s(2),m("ngIf",a.fotoLicencia),s(2),m("ngIf",a.id!==null),s(),m("ngIf",a.id!==null)}}function ae(c,r){if(c&1&&(o(0,"div"),l(1),n()),c&2){let a=p();N("mt-4 p-2 rounded ",a.toastClass,""),s(),L(" ",a.toastMessage," ")}}function ce(c,r){if(c&1){let a=x();o(0,"app-licencia-modal",15),h("closeModal",function(){f(a);let i=p();return _(i.handleCloseModal())})("saveLicencia",function(i){f(a);let t=p();return _(t.saveLicencia(i))})("fileSelected",function(i){f(a);let t=p();return _(t.onFileSelected(i))}),n()}if(c&2){let a=p();m("licencia",a.selectedLicencia)("isEditMode",a.isEditMode)("docentes",a.docentes)("programaciones",a.programaciones)}}function le(c,r){if(c&1){let a=x();o(0,"app-confirm-modal",16),h("confirm",function(){f(a);let i=p();return _(i.deleteLicencia())})("cancel",function(){f(a);let i=p();return _(i.cancelDelete())}),n()}c&2&&m("message","\xBFEst\xE1 seguro que desea eliminar esta licencia?")}var Ce=(()=>{let r=class r{constructor(e){this.http=e,this.licencias=[],this.docentes=[],this.materias=[],this.aulas=[],this.sesionesClase=[],this.programaciones=[],this.selectedLicencia={id:null,docenteId:null,programacionAcademicaId:null,fecha:"",motivo:"",fotoLicencia:null},this.selectedFile=null,this.showModal=!1,this.showConfirmModal=!1,this.isEditMode=!1,this.toastMessage=null,this.toastClass="",this.licenciaIdToDelete=null}ngOnInit(){this.loadLicencias(),this.loadDocentes(),this.loadMaterias(),this.loadAulas(),this.loadSesionesClase(),this.loadProgramaciones()}loadLicencias(){this.http.get("http://192.168.0.18/licencias/").subscribe(e=>{this.licencias=e},e=>{console.error("Error loading licencias",e)})}loadDocentes(){this.http.get("http://192.168.0.18/docentes/").subscribe(e=>{this.docentes=e},e=>{console.error("Error loading docentes",e)})}loadMaterias(){this.http.get("http://192.168.0.18/materias/").subscribe(e=>{this.materias=e},e=>{console.error("Error loading materias",e)})}loadAulas(){this.http.get("http://192.168.0.18/aulas/").subscribe(e=>{this.aulas=e},e=>{console.error("Error loading aulas",e)})}loadSesionesClase(){this.http.get("http://192.168.0.18/sesionesclase/").subscribe(e=>{this.sesionesClase=e},e=>{console.error("Error loading sesiones clase",e)})}loadProgramaciones(){this.http.get("http://192.168.0.18/programacionesacademicas/").subscribe(e=>{this.programaciones=e},e=>{console.error("Error loading programaciones",e)})}getNombreDocente(e){let i=this.docentes.find(t=>t.id===e);return i?i.nombre:"Desconocido"}getApellido(e){let i=this.docentes.find(t=>t.id===e);return i?i.apellido:"Desconocido"}getMateriaNombre(e){let i=this.materias.find(t=>t.id===e);return i?i.nombre:"Desconocido"}getAulaNombre(e){let i=this.aulas.find(t=>t.id===e);return i?i.nombre:"Desconocido"}getFormattedSesionClase(e){return this.sesionesClase.filter(t=>e.includes(t.id)).map(t=>`${t.diaSemana.slice(0,3).toUpperCase()} ${t.horaInicio}-${t.horaFin}`).join(" ")}getProgramacionDescripcion(e){if(e===null)return"Sin programaci\xF3n";let i=this.programaciones.find(t=>t.id===e);if(i){let t=this.getMateriaNombre(i.materiaId),u=this.getAulaNombre(i.aulaId),d=this.getFormattedSesionClase(i.sesionClaseIds);return`${i.grupo}: ${t} - ${u} (${d})`}return"Desconocido"}editLicencia(e){e!==null&&(this.selectedLicencia=this.licencias.find(i=>i.id===e)||this.selectedLicencia,this.isEditMode=!0,this.showModal=!0)}addLicencia(){this.selectedLicencia={id:null,docenteId:null,programacionAcademicaId:null,fecha:"",motivo:"",fotoLicencia:null},this.selectedFile=null,this.isEditMode=!1,this.showModal=!0}confirmDelete(e){e!==null&&(this.licenciaIdToDelete=e,this.showConfirmModal=!0)}deleteLicencia(){this.licenciaIdToDelete!==null&&this.http.delete(`http://192.168.0.18/licencias/${this.licenciaIdToDelete}`).subscribe(()=>{this.showToast("Licencia eliminada con \xE9xito","success"),this.loadLicencias(),this.licenciaIdToDelete=null,this.showConfirmModal=!1},e=>{this.showToast("Error al eliminar la Licencia","error"),console.error("Error deleting licencia",e)})}cancelDelete(){this.licenciaIdToDelete=null,this.showConfirmModal=!1}saveLicencia(e){let i=new FormData;i.append("licencia",new Blob([JSON.stringify(e)],{type:"application/json"})),this.selectedFile&&i.append("file",this.selectedFile),this.http.post("http://192.168.0.18/licencias/createOrUpdate",i).subscribe(()=>{this.showToast("Licencia guardada con \xE9xito","success"),this.loadLicencias()},t=>{this.showToast("Error al guardar la Licencia","error"),console.error("Error creating or updating licencia",t)}),this.handleCloseModal()}handleCloseModal(){this.showModal=!1}handleCloseConfirmModal(){this.showConfirmModal=!1}showToast(e,i){this.toastMessage=e,this.toastClass=i==="success"?"bg-green-500 text-white":"bg-red-500 text-white",setTimeout(()=>{this.toastMessage=null},2e3)}onFileSelected(e){let i=e.target;i.files?.length&&(this.selectedFile=i.files[0])}};r.\u0275fac=function(i){return new(i||r)(E(k))},r.\u0275cmp=S({type:r,selectors:[["app-licencia"]],standalone:!0,features:[I],decls:27,vars:4,consts:[[1,"container","mx-auto","px-4","py-8"],[1,"text-2xl","font-bold","mb-4"],[1,"min-w-full","bg-white"],[1,"py-2","px-4","border-b"],[4,"ngFor","ngForOf"],[1,"bg-green-500","text-white","px-4","py-2","rounded-md","mt-4",3,"click"],[3,"class",4,"ngIf"],[3,"licencia","isEditMode","docentes","programaciones","closeModal","saveLicencia","fileSelected",4,"ngIf"],[3,"message","confirm","cancel",4,"ngIf"],["alt","Foto Licencia","class","h-16 w-16 object-cover",3,"src",4,"ngIf"],["class","bg-blue-500 text-white px-3 py-1 rounded-md",3,"click",4,"ngIf"],["class","bg-red-500 text-white px-3 py-1 rounded-md ml-2",3,"click",4,"ngIf"],["alt","Foto Licencia",1,"h-16","w-16","object-cover",3,"src"],[1,"bg-blue-500","text-white","px-3","py-1","rounded-md",3,"click"],[1,"bg-red-500","text-white","px-3","py-1","rounded-md","ml-2",3,"click"],[3,"closeModal","saveLicencia","fileSelected","licencia","isEditMode","docentes","programaciones"],[3,"confirm","cancel","message"]],template:function(i,t){i&1&&(o(0,"div",0)(1,"h1",1),l(2,"Gestionar Licencias"),n(),o(3,"table",2)(4,"thead")(5,"tr")(6,"th",3),l(7,"ID"),n(),o(8,"th",3),l(9,"Docente"),n(),o(10,"th",3),l(11,"Programaci\xF3n Acad\xE9mica"),n(),o(12,"th",3),l(13,"Fecha"),n(),o(14,"th",3),l(15,"Motivo"),n(),o(16,"th",3),l(17,"Foto Licencia"),n(),o(18,"th",3),l(19,"Acciones"),n()()(),o(20,"tbody"),g(21,oe,16,9,"tr",4),n()(),o(22,"button",5),h("click",function(){return t.addLicencia()}),l(23,"A\xF1adir Licencia"),n(),g(24,ae,2,4,"div",6),n(),g(25,ce,1,4,"app-licencia-modal",7)(26,le,1,1,"app-confirm-modal",8)),i&2&&(s(21),m("ngForOf",t.licencias),s(3),m("ngIf",t.toastMessage),s(),m("ngIf",t.showModal),s(),m("ngIf",t.showConfirmModal))},dependencies:[D,F,T,V,K,J],styles:["table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:10px;text-align:left;border:1px solid #dee2e6}th[_ngcontent-%COMP%]{background-color:#011d3a;color:#fff}"]});let c=r;return c})();export{Ce as LicenciaComponent};
