import{a as q}from"./chunk-4IA42FLE.js";import{a as W,b as k,c as L,d as $,e as B,f as j,g as G,h as z,i as H,k as U,m as T}from"./chunk-OGDTTBTQ.js";import{b as V}from"./chunk-6QFG5ZSD.js";import{Ba as r,Ca as F,Oa as f,Qa as m,Qb as S,Rb as v,Sa as P,Ta as a,Tb as I,Ua as i,Ya as E,Za as h,_a as u,aa as w,db as s,eb as g,fb as M,gb as O,ib as C,ja as _,jb as b,ka as A,kb as x,mb as y,sa as D}from"./chunk-TYC4EHML.js";function R(l,d){if(l&1&&(a(0,"option",18),s(1),i()),l&2){let o=d.$implicit,e=u();m("value",o.id),r(),g(e.getProgramacionDescripcion(o))}}function X(l,d){if(l&1&&(a(0,"div")(1,"p")(2,"strong"),s(3,"Materia:"),i(),s(4),i(),a(5,"p")(6,"strong"),s(7,"Aula:"),i(),s(8),i(),a(9,"p")(10,"strong"),s(11,"Horarios:"),i(),s(12),i()()),l&2){let o=u();r(4),M(" ",o.getNombreMateria(o.selectedProgramacion.materiaId),""),r(4),M(" ",o.getNombreAula(o.selectedProgramacion.aulaId),""),r(4),M(" ",o.getFormattedSesionClase(o.selectedProgramacion.sesionClaseIds),"")}}function Y(l,d){if(l&1&&(a(0,"option",18),s(1),i()),l&2){let o=d.$implicit;m("value",o.id),r(),O("",o.nombre," ",o.apellido,"")}}var J=(()=>{let d=class d{constructor(){this.asistencia={id:0,programacionAcademicaId:0,estadoAsistenciaId:1,docenteId:0,fecha:"",observaciones:"",latitud:0,longitud:0},this.isEditMode=!1,this.programacionesAcademicas=[],this.estadosAsistencia=[],this.docentes=[],this.materias=[],this.aulas=[],this.sesionesClase=[],this.closeModal=new D,this.saveAsistencia=new D,this.selectedProgramacion=null}ngOnInit(){this.getCurrentLocation(),this.isEditMode||(this.asistencia.fecha=this.getCurrentDate()),this.onProgramacionChange()}handleSave(){this.saveAsistencia.emit(this.asistencia)}handleClose(){this.closeModal.emit()}getCurrentLocation(){navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{this.asistencia.latitud=e.coords.latitude,this.asistencia.longitud=e.coords.longitude},e=>{console.error("Error getting location: ",e)}):console.error("Geolocation is not supported by this browser.")}getCurrentDate(){return new Date().toISOString()}onProgramacionChange(){this.selectedProgramacion=this.programacionesAcademicas.find(e=>e.id===this.asistencia.programacionAcademicaId)||null}getNombreMateria(e){if(e===null)return"N/A";let n=this.materias.find(t=>t.id===e);return n?n.nombre:"N/A"}getNombreAula(e){if(e===null)return"N/A";let n=this.aulas.find(t=>t.id===e);return n?n.nombre:"N/A"}getFormattedSesionClase(e){return this.sesionesClase.filter(t=>e.includes(t.id)).map(t=>`${t.diaSemana.slice(0,3).toUpperCase()} ${t.horaInicio}-${t.horaFin}`).join(" ")}getProgramacionDescripcion(e){let n=this.getNombreMateria(e.materiaId),t=this.getNombreAula(e.aulaId),p=this.getFormattedSesionClase(e.sesionClaseIds);return`${e.grupo}: ${n} - ${t} (${p})`}};d.\u0275fac=function(n){return new(n||d)},d.\u0275cmp=w({type:d,selectors:[["app-asistencia-modal"]],inputs:{asistencia:"asistencia",isEditMode:"isEditMode",programacionesAcademicas:"programacionesAcademicas",estadosAsistencia:"estadosAsistencia",docentes:"docentes",materias:"materias",aulas:"aulas",sesionesClase:"sesionesClase"},outputs:{closeModal:"closeModal",saveAsistencia:"saveAsistencia"},standalone:!0,features:[y],decls:41,vars:12,consts:[[1,"fixed","inset-0","bg-gray-600","bg-opacity-50","overflow-y-auto","h-full","w-full","flex","justify-center","items-center"],[1,"bg-white","rounded-lg","w-1/3","p-4"],[1,"text-xl","font-bold","mb-4"],[3,"ngSubmit"],[1,"mb-4"],[1,"block","text-gray-700","text-sm","font-bold","mb-2"],["name","programacionAcademicaId",1,"shadow","appearance-none","border","rounded","w-full","py-2","px-3","text-gray-700","leading-tight","focus:outline-none","focus:shadow-outline",3,"ngModelChange","change","ngModel"],["value","0","disabled",""],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["name","docenteId",1,"shadow","appearance-none","border","rounded","w-full","py-2","px-3","text-gray-700","leading-tight","focus:outline-none","focus:shadow-outline",3,"ngModelChange","ngModel"],["type","datetime-local","name","fecha",1,"shadow","appearance-none","border","rounded","w-full","py-2","px-3","text-gray-700","leading-tight","focus:outline-none","focus:shadow-outline",3,"ngModelChange","ngModel"],["type","text","name","observaciones",1,"shadow","appearance-none","border","rounded","w-full","py-2","px-3","text-gray-700","leading-tight","focus:outline-none","focus:shadow-outline",3,"ngModelChange","ngModel"],["type","number","name","latitud",1,"shadow","appearance-none","border","rounded","w-full","py-2","px-3","text-gray-700","leading-tight","focus:outline-none","focus:shadow-outline",3,"ngModelChange","ngModel","readonly"],["type","number","name","longitud",1,"shadow","appearance-none","border","rounded","w-full","py-2","px-3","text-gray-700","leading-tight","focus:outline-none","focus:shadow-outline",3,"ngModelChange","ngModel","readonly"],[1,"flex","items-center","justify-between"],["type","submit",1,"bg-blue-500","hover:bg-blue-700","text-white","font-bold","py-2","px-4","rounded","focus:outline-none","focus:shadow-outline"],["type","button",1,"bg-gray-500","hover:bg-gray-700","text-white","font-bold","py-2","px-4","rounded","focus:outline-none","focus:shadow-outline",3,"click"],[3,"value"]],template:function(n,t){n&1&&(a(0,"div",0)(1,"div",1)(2,"h2",2),s(3),i(),a(4,"form",3),h("ngSubmit",function(){return t.handleSave()}),a(5,"div",4)(6,"label",5),s(7,"Programaci\xF3n Acad\xE9mica"),i(),a(8,"select",6),x("ngModelChange",function(c){return b(t.asistencia.programacionAcademicaId,c)||(t.asistencia.programacionAcademicaId=c),c}),h("change",function(){return t.onProgramacionChange()}),a(9,"option",7),s(10,"Selecciona la Programaci\xF3n Acad\xE9mica"),i(),f(11,R,2,2,"option",8),i(),f(12,X,13,3,"div",9),i(),a(13,"div",4)(14,"label",5),s(15,"Docente"),i(),a(16,"select",10),x("ngModelChange",function(c){return b(t.asistencia.docenteId,c)||(t.asistencia.docenteId=c),c}),a(17,"option",7),s(18,"Selecciona el Docente"),i(),f(19,Y,2,3,"option",8),i()(),a(20,"div",4)(21,"label",5),s(22,"Fecha"),i(),a(23,"input",11),x("ngModelChange",function(c){return b(t.asistencia.fecha,c)||(t.asistencia.fecha=c),c}),i()(),a(24,"div",4)(25,"label",5),s(26,"Observaciones"),i(),a(27,"input",12),x("ngModelChange",function(c){return b(t.asistencia.observaciones,c)||(t.asistencia.observaciones=c),c}),i()(),a(28,"div",4)(29,"label",5),s(30,"Latitud"),i(),a(31,"input",13),x("ngModelChange",function(c){return b(t.asistencia.latitud,c)||(t.asistencia.latitud=c),c}),i()(),a(32,"div",4)(33,"label",5),s(34,"Longitud"),i(),a(35,"input",14),x("ngModelChange",function(c){return b(t.asistencia.longitud,c)||(t.asistencia.longitud=c),c}),i()(),a(36,"div",15)(37,"button",16),s(38," Guardar "),i(),a(39,"button",17),h("click",function(){return t.handleClose()}),s(40," Cancelar "),i()()()()()),n&2&&(r(3),g(t.isEditMode?"Editar Asistencia":"A\xF1adir Asistencia"),r(5),C("ngModel",t.asistencia.programacionAcademicaId),r(3),m("ngForOf",t.programacionesAcademicas),r(),m("ngIf",t.selectedProgramacion),r(4),C("ngModel",t.asistencia.docenteId),r(3),m("ngForOf",t.docentes),r(4),C("ngModel",t.asistencia.fecha),r(4),C("ngModel",t.asistencia.observaciones),r(4),C("ngModel",t.asistencia.latitud),m("readonly",!1),r(4),C("ngModel",t.asistencia.longitud),m("readonly",!1))},dependencies:[I,S,v,T,j,H,U,W,G,z,k,L,B,$]});let l=d;return l})();function Z(l,d){if(l&1){let o=E();a(0,"tr")(1,"td",3),s(2),i(),a(3,"td",3),s(4),i(),a(5,"td",3),s(6),i(),a(7,"td",3),s(8),i(),a(9,"td",3),s(10),i(),a(11,"td",3),s(12),i(),a(13,"td",3),s(14),i(),a(15,"td",3),s(16),i(),a(17,"td",3)(18,"div",9)(19,"button",10),h("click",function(){let n=_(o).$implicit,t=u();return A(t.editAsistencia(n.id))}),s(20,"Editar"),i(),a(21,"button",11),h("click",function(){let n=_(o).$implicit,t=u();return A(t.confirmDelete(n.id))}),s(22,"Eliminar"),i()()()()}if(l&2){let o=d.$implicit,e=u();r(2),g(o.id),r(2),g(e.getNombreProgramacionAcademica(o.programacionAcademicaId)),r(2),g(e.getNombreEstadoAsistencia(o.estadoAsistenciaId)),r(2),g(e.getNombreDocente(o.docenteId)),r(2),g(o.fecha),r(2),g(o.observaciones),r(2),g(o.latitud),r(2),g(o.longitud)}}function ee(l,d){if(l&1&&(a(0,"div"),s(1),i()),l&2){let o=u();P("mt-4 p-2 rounded ",o.toastClass,""),r(),M(" ",o.toastMessage," ")}}function te(l,d){if(l&1){let o=E();a(0,"app-asistencia-modal",12),h("closeModal",function(){_(o);let n=u();return A(n.handleCloseModal())})("saveAsistencia",function(n){_(o);let t=u();return A(t.saveAsistencia(n))}),i()}if(l&2){let o=u();m("asistencia",o.selectedAsistencia)("isEditMode",o.isEditMode)("programacionesAcademicas",o.programacionesAcademicas)("docentes",o.docentes)("materias",o.materias)("sesionesClase",o.sesionesClase)("aulas",o.aulas)}}function ie(l,d){if(l&1){let o=E();a(0,"app-confirm-modal",13),h("confirm",function(){_(o);let n=u();return A(n.deleteAsistencia())})("cancel",function(){_(o);let n=u();return A(n.cancelDelete())}),i()}l&2&&m("message","\xBFEst\xE1 seguro que desea eliminar esta asistencia?")}var fe=(()=>{let d=class d{constructor(e){this.http=e,this.asistencias=[],this.programacionesAcademicas=[],this.estadosAsistencia=[],this.docentes=[],this.materias=[],this.aulas=[],this.sesionesClase=[],this.selectedAsistencia={id:0,programacionAcademicaId:0,estadoAsistenciaId:0,docenteId:0,fecha:"",observaciones:"",latitud:0,longitud:0},this.showModal=!1,this.showConfirmModal=!1,this.isEditMode=!1,this.toastMessage=null,this.toastClass="",this.asistenciaIdToDelete=null}ngOnInit(){this.loadAsistencias(),this.loadProgramacionesAcademicas(),this.loadEstadosAsistencia(),this.loadDocentes(),this.loadMaterias(),this.loadAulas(),this.loadSesionesClase()}loadAsistencias(){this.http.get("http://192.168.0.15/asistencias/").subscribe(e=>{this.asistencias=e},e=>{console.error("Error loading asistencias",e)})}loadProgramacionesAcademicas(){this.http.get("http://192.168.0.15/programacionesacademicas/").subscribe(e=>{this.programacionesAcademicas=e},e=>{console.error("Error loading programaciones academicas",e)})}loadEstadosAsistencia(){this.http.get("http://192.168.0.15/estadosasistencia/").subscribe(e=>{this.estadosAsistencia=e},e=>{console.error("Error loading estados asistencia",e)})}loadDocentes(){this.http.get("http://192.168.0.15/docentes/").subscribe(e=>{this.docentes=e},e=>{console.error("Error loading docentes",e)})}loadMaterias(){this.http.get("http://192.168.0.15/materias/").subscribe(e=>{this.materias=e},e=>{console.error("Error loading materias",e)})}loadAulas(){this.http.get("http://192.168.0.15/aulas/").subscribe(e=>{this.aulas=e},e=>{console.error("Error loading aulas",e)})}loadSesionesClase(){this.http.get("http://192.168.0.15/sesionesclase/").subscribe(e=>{this.sesionesClase=e},e=>{console.error("Error loading sesiones clase",e)})}getNombreProgramacionAcademica(e){let n=this.programacionesAcademicas.find(t=>t.id===e);if(n){let t=this.materias.find(N=>N.id===n.materiaId),p=this.aulas.find(N=>N.id===n.aulaId),c=this.getFormattedSesionClase(n.sesionClaseIds);return`${n.grupo}:${t?t.nombre:"N/A"} - ${p?p.nombre:"N/A"} (${c})`}return"N/A"}getNombreEstadoAsistencia(e){let n=this.estadosAsistencia.find(t=>t.id===e);return n?n.nombre:"N/A"}getNombreDocente(e){let n=this.docentes.find(t=>t.id===e);return n?n.nombre:"N/A"}getFormattedSesionClase(e){return this.sesionesClase.filter(t=>e.includes(t.id)).map(t=>`${t.diaSemana.slice(0,3).toUpperCase()} ${t.horaInicio}-${t.horaFin}`).join(" ")}editAsistencia(e){this.selectedAsistencia=this.asistencias.find(n=>n.id===e)||this.selectedAsistencia,this.isEditMode=!0,this.showModal=!0}addAsistencia(){this.selectedAsistencia={id:0,programacionAcademicaId:0,estadoAsistenciaId:0,docenteId:0,fecha:this.getCurrentDate(),observaciones:"",latitud:0,longitud:0},this.isEditMode=!1,this.showModal=!0}confirmDelete(e){this.asistenciaIdToDelete=e,this.showConfirmModal=!0}deleteAsistencia(){this.asistenciaIdToDelete!==null&&this.http.delete(`http://192.168.0.15/asistencias/${this.asistenciaIdToDelete}`).subscribe(()=>{this.showToast("Asistencia eliminada con \xE9xito","success"),this.loadAsistencias(),this.asistenciaIdToDelete=null,this.showConfirmModal=!1},e=>{this.showToast("Error al eliminar la Asistencia","error"),console.error("Error deleting asistencia",e)})}cancelDelete(){this.asistenciaIdToDelete=null,this.showConfirmModal=!1}saveAsistencia(e){this.isEditMode?this.http.put(`http://192.168.0.15/asistencias/${e.id}`,e).subscribe(n=>{this.showToast("Asistencia actualizada con \xE9xito","success"),this.loadAsistencias()},n=>{this.showToast("Error al actualizar la Asistencia","error"),console.error("Error updating asistencia",n)}):this.http.post("http://192.168.0.15/asistencias/",e).subscribe(n=>{this.showToast("Asistencia creada con \xE9xito","success"),this.loadAsistencias()},n=>{this.showToast("Error al crear la Asistencia","error"),console.error("Error creating asistencia",n)}),this.handleCloseModal()}handleCloseModal(){this.showModal=!1}handleCloseConfirmModal(){this.showConfirmModal=!1}showToast(e,n){this.toastMessage=e,this.toastClass=n==="success"?"bg-green-500 text-white":"bg-red-500 text-white",setTimeout(()=>{this.toastMessage=null},2e3)}getCurrentDate(){return new Date().toISOString()}};d.\u0275fac=function(n){return new(n||d)(F(V))},d.\u0275cmp=w({type:d,selectors:[["app-asistencia"]],standalone:!0,features:[y],decls:31,vars:4,consts:[[1,"container","mx-auto","px-4","py-8"],[1,"text-2xl","font-bold","mb-4","text-center"],[1,"min-w-full","bg-white","text-sm"],[1,"py-1","px-2","border-b"],[4,"ngFor","ngForOf"],[1,"bg-green-500","text-white","px-4","py-2","rounded-md","mt-4",3,"click"],[3,"class",4,"ngIf"],[3,"asistencia","isEditMode","programacionesAcademicas","docentes","materias","sesionesClase","aulas","closeModal","saveAsistencia",4,"ngIf"],[3,"message","confirm","cancel",4,"ngIf"],[1,"flex","flex-col"],[1,"bg-blue-500","text-white","px-2","py-1","rounded-md","mb-1",3,"click"],[1,"bg-red-500","text-white","px-2","py-1","rounded-md",3,"click"],[3,"closeModal","saveAsistencia","asistencia","isEditMode","programacionesAcademicas","docentes","materias","sesionesClase","aulas"],[3,"confirm","cancel","message"]],template:function(n,t){n&1&&(a(0,"div",0)(1,"h1",1),s(2,"Gestionar Asistencias"),i(),a(3,"table",2)(4,"thead")(5,"tr")(6,"th",3),s(7,"ID"),i(),a(8,"th",3),s(9,"Programaci\xF3n Acad\xE9mica"),i(),a(10,"th",3),s(11,"Estado Asistencia"),i(),a(12,"th",3),s(13,"Docente"),i(),a(14,"th",3),s(15,"Fecha"),i(),a(16,"th",3),s(17,"Observaciones"),i(),a(18,"th",3),s(19,"Latitud"),i(),a(20,"th",3),s(21,"Longitud"),i(),a(22,"th",3),s(23,"Acciones"),i()()(),a(24,"tbody"),f(25,Z,23,8,"tr",4),i()(),a(26,"button",5),h("click",function(){return t.addAsistencia()}),s(27,"A\xF1adir Asistencia"),i(),f(28,ee,2,4,"div",6),i(),f(29,te,1,7,"app-asistencia-modal",7)(30,ie,1,1,"app-confirm-modal",8)),n&2&&(r(25),m("ngForOf",t.asistencias),r(3),m("ngIf",t.toastMessage),r(),m("ngIf",t.showModal),r(),m("ngIf",t.showConfirmModal))},dependencies:[I,S,v,T,J,q],styles:["table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:10px;text-align:left;border:1px solid #dee2e6}th[_ngcontent-%COMP%]{background-color:#011d3a;color:#fff}"]});let l=d;return l})();export{fe as AsistenciaComponent};
